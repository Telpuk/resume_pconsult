!function(a,b,c){function d(){this.$html=a("body"),this.$conclusion=a(".conclusion"),this.$commentAndConclusion=a(".commentAndConclusion"),this.templateComment=a("#template-comment").html(),this.$commentBlock=a(".commentBlock"),this.$addComment=a(".addComment"),this.$addFolder=a("#addFolder"),this.$input_new_folder_block=a("#input_new_folder_block"),this.$inout_text=a("#new_folder"),this.$ajax_loader=a(".ajax_loader"),this.$folders_list_li=a("#folders_list_li"),this.lastActive=0,this.$conclusion=a(".conclusion"),this.conclusion_text,this.cache={},this.$download=a(".download"),this.$download_content=a(".download_content"),this.$widget_right=a("#widget_right"),this.$edit_admin=a("#edit_admin"),this.$icon_user=a("#icon_user"),this.$form_user_admin=a("#form_user_admin"),this.$show_input_password=a("#show_input_password"),this.$password_content=a("#password_content"),this.$ajax_loader_admin=a("#ajax_loader_admin")}d.prototype.resetChecked=function(){a("input[type=checkbox]",this.$download_content).each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&b.prop("checked",!1)})},d.prototype.conclusionClose=function(a){for(var c in this.cache)c!=a.parent().parent().data("idConclusion")&&this.cache[c].element.html("<h1>Заключение <span class='editConclusion'><img src='"+b+"/public/img/edit.png'>редактировать</span><span class='deleteConclusion'><a class='a_deleteConclusion' href='#'><img src='"+b+"/public/img/delete.png'>удалить</a></span></h1><div class='conclusion_text'>"+this.cache[c].text+"</div><div class='clear'></div>")},d.prototype.addEventListenerHtml=function(){this.$html.on("click",{self:this},function(b){var c=a(b.target);return c.hasClass("exampleClick")&&a("input[type=search]",c.parents(".search")).val(c.text()),c.hasClass("exampleClick")&&a("input[type=search]",c.parents(".search")).val(c.text()),b.data.self.$input_new_folder_block.hide(),b.data.self.$addFolder.show(),b.data.self.$inout_text.val(""),b.data.self.conclusionClose(a(b.target)),b.data.self.$download_content.hide(),b.data.self.resetChecked(),"delete_folder"===b.target.className?confirm("Вы действительно хотите удалить?"):void 0})},d.prototype.addEventListenerAddFolder=function(){this.$addFolder.on("click",{self:this},function(b){b.data.self.$input_new_folder_block.show(),a(this).hide(),b.data.self.$download_content.hide(),b.data.self.resetChecked(),b.stopPropagation()})},d.prototype.buildFoldersLI=function(a){var c,d="",e=0,f=0;for(f=0,e=a.length;e>f;++f)c="",this.lastActive==a[f].id&&(c="class='folders_active'"),d+='<li><a class="delete_folder" href="'+b+"/admincontrol/folders/delete/"+a[f].id+'"><img class="delete_folder" src="'+b+'/public/img/folder_remove.png" title="удалить"></a> <a '+c+' data-list-id="'+a[f].id+'" href="'+b+"/admincontrol/folders/id/"+a[f].id+'" >'+a[f].name+"</a></li>";this.$folders_list_li.html(d)},d.prototype.ajaxQuestion=function(c){var d=this;a.post(b+"/admincontrol/ajaxfolders",{ajax:"ajax",folder_name:c}).done(function(b){d.$ajax_loader.hide(),d.$addFolder.show(),d.$input_new_folder_block.hide(),d.$inout_text.val(""),b=a.parseJSON(b),d.buildFoldersLI(b)})},d.prototype.addEventListenerInputNewFolderBlock=function(){this.$input_new_folder_block.on("click",{self:this},function(b){switch(b.target.id){case"button":var c=b.data.self.$inout_text.val();""!==a.trim(c)&&(b.data.self.$ajax_loader.show(),b.data.self.ajaxQuestion(c),b.data.self.lastActive=a("a",b.data.self.$folders_list_li).filter(".folders_active").data("listId")),b.stopPropagation();break;case"new_folder":b.stopPropagation()}b.data.self.$download_content.hide(),b.data.self.resetChecked()})},d.prototype.addEventListenerConclusion=function(){this.$conclusion.on("click",{self:this},function(c){var d=a(this);if("button_conclusion"===c.target.className){var e=a(c.target),f=e.siblings(".conclusion_textarea");""===f.val()?f.css({border:"2px solid red"}):0!==f.val()&&a.post(b+"/admincontrol/conclusion",{updateConclusion:"updateConclusion",conclusion:f.val(),id_user:f.parent().data("idConclusion")}).done(function(c){"true"===c&&(f.parent().html("<h1>Заключение <span class='editConclusion'><img src='"+b+"/public/img/edit.png'>редактировать</span><span class='deleteConclusion'><a class='a_deleteConclusion' href=''><img src='"+b+"/public/img/delete.png'>удалить</a></span></h1><div class='conclusion_text'>"+f.val()+"</div><div class='clear'></div>"),a(".download_content",d.parent()).prepend("<p><input type='checkbox' class='without_conclusion' value='conclusion'>Без заключения</p>"))})}else if("editConclusion"===c.target.className){var g=a(c.target),f=g.parent().siblings(".conclusion_text");c.data.self.conclusion_text=f.text(),c.data.self.cache[g.parent().parent().data("idConclusion")]={element:g.parent().parent(),text:c.data.self.conclusion_text},c.data.self.conclusionClose(g),g.parent().parent().html("<h1>Заключение <span class='editConclusion back'>отменить</span><span class='deleteConclusion'><a class='a_deleteConclusion' href='#'><img src='"+b+"/public/img/delete.png'>удалить</a></span></h1><textarea class='conclusion_textarea' name='conclusion'>"+f.text()+"</textarea><button class='button_conclusion'>обновить</button><div class='clear'></div>")}else if("editConclusion back"===c.target.className)a(c.target).parent().parent().html("<h1>Заключение <span class='editConclusion'><img src='"+b+"/public/img/edit.png'>редактировать</span><span class='deleteConclusion'><a class='a_deleteConclusion' href='#'><img src='"+b+"/public/img/delete.png'>удалить</a></span></h1><div class='conclusion_text'>"+c.data.self.conclusion_text+"</div><div class='clear'></div>");else if("a_deleteConclusion"===c.target.className){var g=a(c.target);a.post(b+"/admincontrol/conclusion",{updateConclusion:"updateConclusion",conclusion:"",id_user:g.parent().parent().parent().data("idConclusion")}).done(function(b){"true"===b&&(g.parent().parent().parent().html("<h1>Заключение</h1><textarea class='conclusion_textarea' name='conclusion'></textarea><button class='button_conclusion'>сохранить</button><div class='clear'></div>"),a(".without_conclusion",d.parent()).parent().remove())})}else a("textarea",c.data.self.$resume).css({border:"1px solid black"});c.data.self.$download_content.hide(),c.data.self.resetChecked(),c.preventDefault(),c.stopPropagation()})},d.prototype.addEventListenerDownloadWord=function(){this.$download.on("click",{self:this},function(c){var d="/id/"+a(".download_content",a(this)).data("idUser");a("input[type=checkbox]",a(".download_content",a(this))).length?a(".download_content",a(this)).toggle():(location.href=b+"/excel/index"+d,a(".download_content",a(this)).hide()),c.stopPropagation()})},d.prototype.addEventListenerDownloadContent=function(){this.$download_content.on("click",{self:this},function(c){var d={},e="/id/"+a(this).data("idUser");if("button"===c.target.className.toLocaleLowerCase()){a("input[type=checkbox]",a(this)).each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&(d[b.val()]=b.val())});for(var f in d)d.hasOwnProperty(f)&&(e+="/"+d[f]+"/false");location.href=b+"/excel/index"+e,c.data.self.$download_content.hide(),a("input[type=checkbox]",a(this)).each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&b.prop("checked",!1)})}c.stopPropagation()})},d.prototype.addEventListenerWidgetRight=function(){var b=this;this.$icon_user.on("click",function(){b.$widget_right.toggleClass("open"),b.$widget_right.hasClass("open")?b.$widget_right.stop().animate({"margin-right":"0px"},500,"easeInSine"):(b.$form_user_admin.fadeOut(),b.$widget_right.stop().animate({"margin-right":"-300px"},1500,"easeOutBounce"))}),this.$edit_admin.on("click",{self:this},function(b){b.data.self.$form_user_admin.slideToggle(),a("input[type=password]",b.data.self.$password_content).each(function(b,c){a(c).val("")})}),this.$show_input_password.on("click",{self:this},function(b){b.data.self.$password_content.slideToggle(),a("input[type=password]",b.data.self.$password_content).each(function(b,c){a(c).val(""),a(c).css({border:"1px solid black"})})})},d.prototype.addEventListenerFIOContent=function(){this.$form_user_admin.on("submit change",{self:this},function(c){var d=a("#name_first",a(this)),e=a("#login",a(this)),f=a("#name_second",a(this)),g=a("#patronymic",a(this)),h=a("#password_content input[type=password]",a(this));if(""==d.val())return a(".valid",d.parent()).remove(),d.css({border:"1px solid #ff0000"}),d.parent().append('<span class="valid">Обязательно для заполнения</span>').css({color:"red"}),!1;if(d.css({border:"1px solid black"}),a(".valid",d.parent()).remove(),""==e.val())return e.css({border:"1px solid black"}),a(".valid",e.parent()).remove(),e.parent().append('<span  class="valid">Поле email не должно быть пустым</span>'),!1;var i=/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i;if(!i.test(e.val()))return a(".valid",e.parent()).remove(),e.css({border:"1px solid #ff0000"}),e.parent().append('<span  class="valid">Проверьте правильность ввода!</span>'),!1;if(e.css({border:"1px solid black"}),a(".valid",e.parent()).remove(),a(h[0]).val()){var j=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g");if(a(".valid",c.data.self.$password_content).remove(),a(h[0]).css({border:"1px solid black"}),a(h[1]).css({border:"1px solid black"}),!j.test(a(h[0]).val()))return a(h[0]).css({border:"1px solid red"}),c.data.self.$password_content.append('<p><span class="valid">Слабый пароль</span></p>'),!1}return a(h[0]).val()&&!a(h[1]).val()?(a(".valid",c.data.self.$password_content).remove(),a(h[0]).css({border:"1px solid red"}),a(h[1]).css({border:"1px solid red"}),c.data.self.$password_content.append('<p><span  class="valid">Повторите пароль</span></p>'),!1):a(h[0]).val()&&a(h[1]).val()&&a(h[0]).val()!==a(h[1]).val()?(a(h[0]).css({border:"1px solid red"}),a(h[1]).css({border:"1px solid red"}),c.data.self.$password_content.append('<p><span class="valid">Пароли не совпадают</span></p>'),!1):("form"===c.target.tagName.toLocaleLowerCase()&&(c.data.self.$ajax_loader_admin.show(),a.post(b+"/admincontrol/upadminajax",{ajax:"true",admin_info:{login:e.val(),name_first:d.val(),patronymic:g.val(),name_second:f.val(),password:a(h[0]).val()}}).done(function(){c.data.self.$ajax_loader_admin.hide()})),!1)})},d.prototype.buildCommentBlock=function(d,e){var f=this;e.css({background:"url("+b+"/public/img/ajax-loader.gif) 100% 100% no-repeat","background-position":"center"}),a.post(b+"/admincontrol/getcomment",{id:d},function(b){var b=a.parseJSON(b);c.registerHelper("equal",function(a,b,c){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return a!=b?c.inverse(this):c.fn(this)});var d=c.compile(f.templateComment),g=d({object:b});a(".commentBlock",e).html(g),e.css({background:"white"}),f.removeWithoutComments(e.parents(".user_id"))})},d.prototype.addEventListenerCommentAndConclusion=function(){this.$commentAndConclusion.on("click",{self:this},function(b){var c=a(b.target);if(c.hasClass("showComment")){var d=a(".containerComment",c.parents(".user_id"));d.is(":hidden")&&b.data.self.buildCommentBlock(d.data("userId"),d),d.toggle(100),a(".conclusion",c.parents(".user_id")).hide()}else c.hasClass("showConclusion")&&(a(".containerComment",c.parents(".user_id")).hide(),a(".conclusion",c.parents(".user_id")).toggle(100));return!1})},d.prototype.addEventListenerCommentBlock=function(){this.$commentBlock.on("click",{self:this},function(c){var d=a(c.target);if(a(".inputComment",d.parent(".commentBlock").siblings(".addComment")).hide(),d.hasClass("closeBlock")&&d.data("idComment")){var e=d.parents(".containerComment");e.css({background:"url("+b+"/public/img/ajax-loader.gif) 100% 100% no-repeat","background-position":"center"}),a.post(b+"/admincontrol/dcomment",{id:d.data("idComment")},function(){d.parents("fieldset").remove(),c.data.self.removeWithoutComments(e.parent(".user_id")),e.css({background:"white"})})}else if(d.hasClass("closeBlockEdit")&&d.data("idComment")){var f=d.parent("legend").siblings(".commentBlockOld");f.append('<div class="editCommentEdit"><textarea>'+f.text()+'</textarea><span class="backEditComment" style="color: red">ОТМЕНИТЬ</span><span class="saveEditComment" data-id-comment="'+d.data("idComment")+'" style="color: green">СОХРАНИТЬ</span></div>')}else if(d.hasClass("backEditComment"))d.parent(".editCommentEdit").remove();else if(d.hasClass("saveEditComment")&&d.data("idComment")){var g=d.siblings("textarea"),f=d.parents(".commentBlockOld");g.css({background:"url("+b+"/public/img/ajax-loader.gif)  100% 100% no-repeat","background-position":"center"}),g.val()&&a.post(b+"/admincontrol/updatecomment",{content:g.val(),id_com:d.data("idComment")},function(a){"true"===a&&f.text(g.val())})}})},d.prototype.addEventListenerAddComment=function(){this.$addComment.on("click",{self:this},function(c){var d=a(c.target),e=a(this);if(d.hasClass("addSpam"))d.siblings(".inputComment").toggle();else if("button"===c.target.tagName.toLocaleLowerCase()){var f=a("textarea",d.parent("div").siblings("div"));f.val()&&a.post(b+"/admincontrol/addcomment",{comment:f.val(),id_user:d.data("userId")},function(){a(".inputComment",e).hide(),f.val(""),c.data.self.buildCommentBlock(d.data("userId"),e.parent(".containerComment"))})}})},d.prototype.removeWithoutComments=function(b){var c=a(".commentBlock",b),d=a(".download_content",b),e=a("input.without_comments[type=checkbox]",d);a.trim(c.html())?e.length||d.prepend('<p><input type="checkbox" class="without_comments" value="comments">Без комментариев</p>'):e.parent("p").remove()},d.prototype.init=function(){this.addEventListenerDownloadWord(),this.addEventListenerDownloadContent(),this.addEventListenerHtml(),this.addEventListenerWidgetRight(),this.addEventListenerCommentBlock(),this.addEventListenerCommentAndConclusion(),this.addEventListenerAddComment(),this.addEventListenerFIOContent(),this.addEventListenerAddFolder(),this.addEventListenerConclusion(),this.addEventListenerInputNewFolderBlock()};var e=new d;e.init()}(jQuery,BASE_URL,Handlebars,window);