!function(a,b){function c(){this.$resume=a(".resume"),this.$favorite=a(".favorite"),this.$favorite_folds=a("#favorite_folds"),this.$input_text=a("#input_text"),this.$new_checkbox=a("#new_checkbox"),this.$checkbox_list_ul=a("#checkbox_list"),this.$ajax_loader=a("#ajax_loader"),this.$conclusion_text=a(".conclusion_text"),this.$download=a("#download"),this.$download_content=a("#download_content"),this.$comments_add=a("#comments_add > p"),this.$form_comment=a(".form_comment"),this.$commentUser=a(".commentUser")}c.prototype.addEventListenerChangeComment=function(){this.$commentUser.on("click",{self:this},function(c){var d=a(c.target),e=a("p",d.siblings("fieldset")),f=d.siblings(".changeCommentBlock"),g=a("textarea.changeArea",f);d.hasClass("changeComment")&&"ОТМЕНИТЬ"!==d.text()?(d.siblings(".changeCommentBlock").show(100,function(){f.show(),d.siblings(".addCommentChange").show(),g.text(e.text())}),d.text("ОТМЕНИТЬ").css({color:"red"})):d.hasClass("addCommentChange")?(g.css({background:"url("+b+"/public/img/ajax-loader.gif)  100% 100% no-repeat","background-position":"center"}),g.val()&&a.post(b+"/index/updatecomment",{content:g.val(),id_com:d.data("idComment")},function(a){"true"===a&&(e.text(g.val()),f.hide(),d.siblings(".changeComment").text("ИЗМЕНИТЬ").css({color:"#0050a3"}),g.css({background:"none"}),d.hide())})):d.hasClass("changeComment")&&"ОТМЕНИТЬ"===d.text()&&(f.hide(200),d.siblings(".addCommentChange").hide(),d.text("ИЗМЕНИТЬ").css({color:"#0050a3"}))})},c.prototype.addEventListenerEdit=function(){this.$resume.on("click",{self:this},function(c){var d=c.data.self.$conclusion_text.text();"editConclusion"===c.target.className||"conclusion_text"===c.target.className?(a(c.target).text("отменить"),a(".editConclusion").addClass("cancel"),c.data.self.$conclusion_text.html("<form action='"+b+"/index/conclusion' method='post'><textarea class='conclusion_textarea' name='conclusion'>"+d+"</textarea><input class='button_conclusion' type='submit' name='updateConclusion' value='обновить'></form>").hide().fadeIn()):"conclusion_textarea"!=c.target.className&&"button_conclusion"!=c.target.className&&(a(".editConclusion").removeClass("editConclusion cancel").addClass("editConclusion"),a(".editConclusion").html("<img src='"+b+"/public/img/edit.png'>редактировать"),c.data.self.$conclusion_text.text(d).show()),c.data.self.$favorite_folds.hide(400),c.data.self.$download_content.hide(400)})},c.prototype.addEventListenerInputText=function(){this.$input_text.on("keydown change blur",{self:this},function(b){""===a.trim(b.data.self.$input_text.val())?b.data.self.$new_checkbox.prop("checked",!1):b.data.self.$new_checkbox.prop("checked",!0),b.stopPropagation()})},c.prototype.getFoldersLI=function(b,c){var d="",e="";for(var f in c)e="",a.inArray(c[f].id,b)>=0&&(e="checked"),d+='<li><input type="checkbox" value="'+c[f].id+'" '+e+">"+c[f].name+"</li>";this.$checkbox_list_ul.html(d),this.$input_text.val(""),this.$new_checkbox.prop("checked",!1)},c.prototype.ajaxQuery=function(){var c={},d=this;a("#favorite_folds input[type=checkbox]").each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&(c[b.val()]=b.val()),c.new_folder&&(c.new_folder=d.$input_text.val())}),d.$ajax_loader.css("visibility","visible"),a.post(b+"/index/ajaxfoldersusers",{ajax:"ajax",folders:c}).done(function(b){d.$ajax_loader.css("visibility","hidden"),b=a.parseJSON(b),d.getFoldersLI(a.parseJSON(b.user_folders),a.parseJSON(b.folders)),d.$favorite_folds.slideToggle()})},c.prototype.addEventListenerFavoriteFolds=function(){this.$favorite_folds.on("click",{self:this},function(a){"button"===a.target.id&&a.data.self.ajaxQuery(),a.stopPropagation()})},c.prototype.addEventListenerFavorite=function(){this.$favorite.on("click",{self:this},function(c){c.data.self.$favorite_folds.slideToggle(),c.data.self.$favorite_folds.is(":visible")&&a.post(b+"/index/ajaxfoldersusers",{ajax:"ajax",all_checkbox:"true"}).done(function(b){c.data.self.$ajax_loader.css("visibility","hidden"),b=a.parseJSON(b),c.data.self.getFoldersLI(a.parseJSON(b.user_folders),a.parseJSON(b.folders))}),c.stopPropagation()})},c.prototype.addEventListenerDownloadContent=function(){this.$download_content.on("click",{self:this,id:this.$download_content.data("idUser")},function(c){var d={},e="/id/"+c.data.id;if("button"===c.target.id.toLocaleLowerCase()){a("input[type=checkbox]",a(this)).each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&(d[b.val()]=b.val())});for(var f in d)d.hasOwnProperty(f)&&(e+="/"+d[f]+"/false");location.href=b+"/excel/index"+e,c.data.self.$download_content.hide(),a("input[type=checkbox]",a(this)).each(function(){var b=a(this);0!==b.filter(":checkbox:checked").length&&b.prop("checked",!1)})}c.stopPropagation()})},c.prototype.addEventListenerDownloadWord=function(){this.$download.on("click",{self:this,id:this.$download_content.data("idUser")},function(c){var d="/id/"+c.data.id;a("#download_content input[type=checkbox]").length?c.data.self.$download_content.slideToggle():(location.href=b+"/excel/index"+d,c.data.self.$download_content.hide()),c.stopPropagation()})},c.prototype.addEventListenerComments=function(){this.$comments_add.on("click",{self:this},function(a){a.data.self.$form_comment.slideToggle(),a.stopPropagation()})},c.prototype.init=function(){this.addEventListenerComments(),this.addEventListenerDownloadWord(),this.addEventListenerDownloadContent(),this.addEventListenerEdit(),this.addEventListenerFavoriteFolds(),this.addEventListenerFavorite(),this.addEventListenerInputText(),this.addEventListenerChangeComment()};var d=new c;d.init()}(jQuery,BASE_URL,window);